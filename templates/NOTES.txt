
*****************************************************************
*** PLEASE BE PATIENT: ACS may take a few minutes to install ***
*****************************************************************

Thanks for installing the AMRC Connectivity Stack (ACS), the AMRC's open-source implementation of the Factory+ framework.

Ensure that you familiarise yourself with the components and concepts of Factory+ (factoryplus.app.amrc.co.uk) before continuing. This chart installs a full end-to-end deployment of Factory+ and there are a lot of moving parts.

ðŸ“£ Required Steps
-------------

This chart includes an instance of Switchboard to automatically configure DNS and TLS for the various services in the stack. Please refer to https://github.com/borchero/switchboard for more information on how to configure this for your specific deployment.

If you would rather configure DNS & TLS manually then you can disable Switchboard by setting `switchboard.enabled` to `false` in your `values.yaml` file and creating a wildcard DNS entry configured to direct all `*.<baseURL>` requests to your Kubernetes cluster. If you have enabled `acs.secure` then you must also create a wildcard TLS secret on the cluster (type: kubernetes.io/tls) in the `default` namespace with the name `factoryplus-tls` containing the certificate value in the `tls.crt` key and the private key value in the `tls.key` key.

ðŸš€ Get Started
-------------

Get the password for the admin user by running the following command until it returns the password.

echo $(sudo kubectl get secret krb5-passwords -o jsonpath="{.data.admin}" -n {{.Release.Namespace}} | base64 --decode)

Once you have the admin password you can connect to the MQTT broker at {{ .Values.acs.secure | ternary "mqtts://" "mqtt://" }}mqtt.{{.Values.acs.baseUrl}}:{{ .Values.acs.secure | ternary "8883" "1883" }} and subscribe to spBv1.0/#. It's advisable to do this before you start adding devices to the system so that you can see all traffic.

Next, log into the manager at {{ .Values.acs.secure | ternary "https://" "http://" }}manager.{{.Values.acs.baseUrl}} as the `admin` user and create a Group, Node (Soft Gateway) and Device. Configure the device by completing the Information, Connection, and Schema tabs until you see a green VALID tag in the top right corner. Once you've configured the device you should see MQTT traffic begin to flow.

Once data is flowing you can start to build dashboards in Grafana. Log into Grafana with the same admin credentials at {{ .Values.acs.secure | ternary "https://" "http://" }}grafana.{{.Values.acs.baseUrl}} and create a new dashboard, where you'll be given the option of two datasources; InfluxDB (Flux) and InfluxDB (InfluxQL). You can read more about the differences between Flux and InfluxQL at the link below, but in short InfluxQL is older but easier to get started with and Flux is more powerful but has a steeper learning curve. Factory+ creates a measurement for each metric configured for a device, so if you have more than one of the same type of device make sure to apply additional WHERE statements to the query to filter to the correct group, node and device.

https://docs.influxdata.com/influxdb/v2.7/reference/syntax/flux/flux-vs-influxql/

Services
--------
Manager: {{ .Values.acs.secure | ternary "https://" "http://" }}manager.{{.Values.acs.baseUrl}}
MQTT: {{ .Values.acs.secure | ternary "mqtts://" "mqtt://" }}mqtt.{{.Values.acs.baseUrl}}:{{ .Values.acs.secure | ternary "8883" "1883" }}
Grafana: {{ .Values.acs.secure | ternary "https://" "http://" }}grafana.{{.Values.acs.baseUrl}}
