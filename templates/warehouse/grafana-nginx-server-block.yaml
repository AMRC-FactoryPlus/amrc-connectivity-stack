apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-proxy-server-block
  namespace: {{ .Release.Namespace }}
  labels:
    component: warehouse
data:
  server-block.conf: |
    server {
        listen 80;
        listen [::]:80;
        server_name grafana.{{.Values.acs.baseUrl | required "values.acs.baseUrl is required"}};

        location / {
            proxy_set_header Host $http_host;
            proxy_pass http://{{ .Release.Name }}-grafana.{{ .Release.Namespace }}.svc.cluster.local;
        }
    }
